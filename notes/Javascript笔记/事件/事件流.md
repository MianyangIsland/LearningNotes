第17章:事件.

js于html的交互是通过事件实现的,事件代表文档或浏览器窗口中某个有意义的时刻.可以使用仅在事件发生时执行的监听器订阅消息.在传统软件工程领域,这个模型叫"观察者模式",其能够做到页面行为于页面展示的分离.

17.1事件流:

事件流描述了页面接收事件的顺序.结果非常有意思,I结果非常有意思,IE和Netscape开发团队提出了几乎完全相反的事件流方案.IE将支持事件冒泡流,而Netscapr Communicator将支持事件捕获流.

17.1.1事件冒泡:

IE事件流被称为事件冒泡,这是因为事件被认定为从最具体的元素开始发生,然后向上传播至没有那么具体的元素.现代浏览器中的事件会一直冒泡到click事件.

17.1.2事件捕获:

事件捕获的意思是最不具体的节点应该最先收到事件,而最具体的节点应该最后收到事件.事件捕获实际上是为了在事件到达最终目标前拦截事件.

由于旧版本浏览器不支持,因此实际当中几乎不会使用事件捕获.通常建议使用事件冒泡,特殊情况下可以使用事件捕获.

17.1.3DOM事件流:

DOM2Events规范规定事件流分为3个阶段:事件捕获,到达目标和事件冒泡.事件捕获最先发生,为提前拦截事件提供了可能.然后,实际的目标元素接收到事件.最后一个阶段是冒泡,最迟要在这个阶段响应事件.

在DOM事件流中,实际的目标(<div>元素)在捕获阶段不会接收到事件.这是因为捕获阶段从document到<html>再到<body>就结束了.下一阶段,在<div>元素上触发事件的"到达目标"阶段,通常在事件处理时被认为是冒泡阶段的一部分.然后,冒泡阶段开始,事件反向传播至文档.

17.2 事件处理程序:

为响应事件而调用的函数被称为事件处理程序.事件处理程序的名字以"on"开头,因此click事件的处理程序叫做onclick,而load事件的处理程序叫onload.

17.2.1 HTML事件处理程序:

特定元素支持的每个事件都可以使用事件处理程序的名字以HTML属性的形式来指定.此时属性的值必须是能够执行的javascript代码.

在HTML中定义的事件处理程序可以包括精确的动作指令,也可以调用在页面其他地方定义的脚本.作为事件处理程序执行的代码可以访问全局作用域中的一切.

```js
<input type="button" value="Click Me" onclick="console.log(this.value)">
```

这个动态创建的包装函数还有一个特别有意思的地方,就是其作用域链被扩展了.在这个函数中,document和元素自身的成员都可以被当成局部变量来访问.这是通过with实现的:

```js
function()
        {
            with(document)
            {
                with(this)
                {
                    //属性值
                }
            }
        }
```

在HTML中指定事件处理程序有一些问题.第一个问题是时机问题.有可能HTML元素已经显示在页面上,用户都与其交互了,而事件处理程序的代码还无法执行.为此,大多数HTML事件处理程序会封装在try/catch快中,以便在这种情况下默认失败.

```js
<input type="button" value="Click Me" onclick="try{showMessage();} catch(ex){}">
```

这样,如果在showMessage()函数定义之前点击了按钮,就不会发生javascript错误了,这是因为错误在浏览器收到之前已经被拦截了.

17.2.2 DOM0事件处理程序:

每个元素(包括window和document)都有通常小写的事件处理程序属性,比如onclick.只要把这个属性赋值为一个函数即可:

```js
let btn = document.getElementById('myBtn');
        btn.onclick = function()
        {
            console.log('Clciked');
        }
```

像这样使用DOM0方式为事件处理程序赋值时,所赋函数被视为元素的方法.因此,事件处理程序会在元素的作用域中运行,即this等于元素.

```js
let btn = document.getElementById('myBtn');
        btn.onclick = function()
        {
            console.log(this.id);
        }
```

在事件处理程序里通过this可以访问元素的任何属性和方法.以这种方式添加事件处理程序是注册在事件流的冒泡阶段.

通过将事件处理程序属性的值设置为null,可以移除通过DOM方式添加的事件处理程序.

```js
 btn.onclick = null;//移除事件处理程序
```

17.2.3 DOM2事件处理程序:

