

#### 三. 数据链路层 :

3.1 数据链路层概述:

   链路: 从一个结点到相邻结点的一段物理线路,而中间没有任何其他的交换结点.

   数据链路: 指把实现通信协议的硬件到软件加到链路上,就构成了数据链路.

   数据链路层以帧为单位传输和处理数据.

3.2 封装成帧;

封装成帧是指数据链路层给上层交付的协议数据据单元添加帧头和帧尾使之成为帧.

  帧头和帧尾中包含有重要的控制信息. 帧头和帧尾的作用之一就是帧定界.

透明传输是指数据链路层对上层交付的传输数据没有任何限制,就好像数据链路层不存在一样.

 面向字节的物理链路使用字节填充(或称字符填充)的方法实现透明传输.

 面向比特的物理链路使用比特填充的方法实现透明传输.

 为了提高帧的传输效率,应当使帧的数据部分的长度尽可能大些. 考虑到差错控制等多种因素,每一种数据链路层协议都规定了帧的数据部分的长度上限,即最大传送单元MTU.

3.3 差错检测:

 实际的通信链路都不是理想的,比特在传输过程中可能会产生差错: 1可能会变成0,而0也可能变成1.这称为比特差错.

在一段时间内,传输错误的比特占所传输比特总数的比率称为误码率BER.

使用差错检测吗来检测数据在传输过程中是否产生了比特差错,是数据链路层所i要解决的重要问题之一.

奇偶校验:

在待发送的数据后面添加1位奇偶校验位,使整个数据(包含所添加的校验位在内)中"1"的个数为奇数(奇校验)或偶数(偶校验).

如果有奇数个位发生误码,则奇偶性发生变化,可以检查出误码.

如果有偶数个位发生误码,则奇偶性不发生变化,不能检查出误码(漏检).

循环冗余检验CRC:

收发双方约定好一个生成多项式G(x).

收发方基于待发送的数据和生成多项式计算出差错检测吗(冗余码),将其添加到待传输数据的后面一起传输.

接收方通过生成多项式来计算收到的数据是否产生了误码;

算法要求生成多项式必须包含最低次项.

![1661411544021](C:\Users\22719\AppData\Local\Temp\1661411544021.png)

![1661411601757](C:\Users\22719\AppData\Local\Temp\1661411601757.png)

检错码只能检测出帧在传输过程中出现了差错,但并不能定位错误,因此无法纠正错误.

想要纠正传输中的差错,可以使用冗余信息更多的纠错码向前纠错.但纠错码的开销比较大,在计算机网络中较少使用.

循环冗余校验CRC有很好的检错能力(漏检率非常低),虽然计算比较复杂,但非常易于用硬件实现,因此被广泛应用于数据链路层.

在计算机网络中通常采用我们后续课程中讨论的检错重传方式来纠正传输中的差错,或者仅仅是丢弃检测到差错的帧,这取决于数据链路层向上层提供的是可靠传输服务还是不可靠传输服务.

3.4.1 可靠传输的基本概念:

 使用差错检测技术(例如循环冗余校验CRC),接收方的数据链路层就可检测出帧在传输过程中是否产生了误码(比特错误).

数据链路层向上层提供的服务类型:

 不可靠传输服务:仅仅丢弃有误码的帧,其他什么也不做;

可靠传输服务: 想办法实现发送端发送什么,接收端就收到什么.

比特差错只是传输差错中的一种.从整个计算机网络体系结构来看,传输差错还包括分组丢失,分组失序以及分组重复.

分组丢失,分别失序以及分组重复这些传输差错,一般不会出现在数据链路层,而会出现在其上层.

可靠传输服务并不仅局限于数据链路层,其他各层可选择实现可靠传输.

可靠传输的实现比较复杂,开销也比较大,是否使用可靠传输取决于应用需求.

3.4.2 可靠传输的实现机制 -------  停止等待协议SW.

![1661437053458](C:\Users\22719\AppData\Local\Temp\1661437053458.png)

3.4.3 回退N帧协议GBN

![1661437153454](C:\Users\22719\AppData\Local\Temp\1661437153454.png)

3.4.4  选择重传协议SR

![1661437213946](C:\Users\22719\AppData\Local\Temp\1661437213946.png)

3.5 点对点协议PPP

![1661437306021](C:\Users\22719\AppData\Local\Temp\1661437306021.png)

3.6 .1 媒体接入控制的基本概念:

共享信道要着重考虑的一个问题就是如何协调多个发送和接收站点对一个共享传输媒体的占用,即媒体接入控制MAC.

随着技术的发展,交换技术的成熟和成本的降低,具有更高性能的使用点对点链路和链路层交换机的交换式局域网在有线领域已完全取代了共享式局域网,但由于无线信道的广播天性,无线局域网仍然使用的是共享媒体技术.

3.6.2 媒体接入控制 ------  静态划分信道

信道复用   复用是通信技术中的一个重要概念.复用就是通过一条物理线路同时传输多路用户的信号.

当网络中传输媒体的传输容量大于多条单一信道传输时的总通信量时,可利用复用技术在一条物理线路上建立多条通信信道来充分利用传输媒体的带宽.

(1)频分复用 FDM :  将传输线路的频带资源划分成多个子频带,形成多个子信道,各子信道之间需要留出隔离频带,以免造成子信道间的干扰.

频分复用的所有用户同时占用不同的频带资源并行通信.

(2)时分复用TDM : 时分复用的所有用户在不同的时间占用同样的频带宽度.

(3)波分复用: WDM  ; 

(4)码分复用: CDM :  码分复用 CDM 是另一种共享信道的方法.实际上,由于该技术主要用于多址接入,人们更常用的名词是码分多址CDMA.

同理,频分复用FDM和时分复用TDM同样珂用于多址接入,相应的名词是频分多址FDMA和时分多址TDMA.

在本课程中,我们不严格区分复用与多址的概念.可简单理解如下:

  复用是将单一媒体的频带资源划分成很多子信道,这些子信道之间相互独立,互不干扰.从媒体的整体频带资源上看,每个子信道只占用该媒体频带资源的一部分.

多址(更确切地应该称为多点接入)处理的是动态分配信道给用户.这在用户仅仅暂时性地占用信道地应用中是必须地,而所有地移动通信系统基本上都属于这种情况.相反,在信道永久性地分配给用户地应用中,多址是不需要地(对于无线广播或电视广播站就是这样地).

某种程度上,FDMA,TDMA,CDMA可以分别看成是FDM,TDM,CDM地应用.

与FDM和TDM不同,CDM的每一个用户可以在同样的时间使用同样的频带进行通信.

由于各用户使用经过特殊挑选的不同码型,因此各用户之间不会造成干扰.

CDM最初是用于军事通信的,因为这种系统所发送的信号有很强的抗干扰能力,其频谱类似于白噪声,不易被敌人发现.

在CDMA中,在一个比特时间再划分为m个短的间隔,称为码片.通常m的值是64或128,为了简单起见,在后续的举例中,我们假设m为8.

使用CDMA的每一个站被指派一个唯一的m bit码片序列.

一个站如果要发送比特1,则发送它自己的m bit码片序列.

一个站如果要发送比特0, 则发送它自己的m bit码片序列的二进制反码.

码片序列的挑选原则如下:

1.分配给每个站的码片序列必须各不相同,实际常采用伪随机码序列.

2.分配给每个站的码片序列必须相互正交(规格化内积为0).

令向量S表示站S的码片序列,令向量T表示其他任何站的码片序列.  两个不同站S和T的码片序列正交,就是向量S和T的规格化内积为0:

![1661493488592](C:\Users\22719\AppData\Local\Temp\1661493488592.png)

3.6.3 媒体接入控制 ----  动态接入控制  ----  随机接入

总线局域网使用的协议:     载波监听多址接入/碰撞检测 CSMA/CD

多址接入MA : 多个站连接在一条总线上,竞争使用总线.

载波监听CS: 每一个站在发送帧之前要检测一下总线上是否有其他站点在发送帧("先听后说"):若检测到总线空闲96比特时间,则发送这个帧;若检测到总线忙,则继续检测并等待总线转为空闲96比特时间,然后发送这个帧.

碰撞检测CD : 每一个正在发送帧的站边发送边检测碰撞('边听边说'):一旦发现总线上出现碰撞,则立即停止发送,退避一段随机时间后再次发送('一旦冲突,立即停说,等待时机,重新再说').

CSMA/CD 协议   ----  争用期(碰撞窗口)

![1661511959921](C:\Users\22719\AppData\Local\Temp\1661511959921.png)

![1661512112009](C:\Users\22719\AppData\Local\Temp\1661512112009.png)

最小帧长 =  争用期   *   数据传输速率

CSMA/CD    -----  截断二进制指数退避算法.

![1661512365888](C:\Users\22719\AppData\Local\Temp\1661512365888.png)

![1661512709654](C:\Users\22719\AppData\Local\Temp\1661512709654.png)

(2)无线局域网使用的协议:CSMA/CA :

载波监听多址接入/碰撞避免 CSMA/CA

在无线局域网中,仍然可以使用载波监听多址输入CSMA,即在发送帧之前先对传输媒体进行载波监听.若发现有其他站在发送帧,就推迟发送以避免发生碰撞.

在无线局域网中,不能使用碰撞检测CD: 原因如下:

由于无线信道的传输条件特殊,其信号强度的动态范围非常大,无线网卡上接收到的信号强度往往会远远小于发送信号的强度(可能相差百万倍).如果要在无线网卡上实现碰撞检测CD,对硬件的要求非常高.

即使能够在硬件上实现无线局域网的碰撞检测功能,但由于无线电波传播的特殊性(存在隐蔽站问题),进行碰撞检测的意义也不大.

802.11无线局域网使用CSMA/CA协议,在CSMA的基础上增加了一个碰撞避免CA功能,而不再实现碰撞检测功能.

由于不可能避免所有的碰撞,并且无线信道误码率较高,802.11标准还使用了数据链路层确认机制(停止-等待协议)来保证数据被正确接收.

802.11的MAC层标准定义了两种不同的媒体接入控制方式:

分布式协调功能DCF.在DCF方式下,没有中心控制站点,每个站点使用CSMA/CA协议通过争用信道来获取发送权,这是802.11定义的默认方式.

点协调功能PCF.PCF方式使用集中控制的接入算法(一般在接入点AP实现集中控制),是802.11定义的可选方式,在实际中较少使用.

![1661514713695](C:\Users\22719\AppData\Local\Temp\1661514713695.png)

CSMA/CA协议的工作原理:

源站为什么在检测到信道空闲后还要再等待一段时间DIFS ?

答:考虑到可能有其他的站有高优先级的帧要发送.若有,就要让高优先级帧发送.

目的站为什么正确接收数据帧后还要等待一段时间SIFS才能发送ACK帧?

答:SIFS是最短的帧间间隔,用来分隔开属于一次对话的各帧.在这段时间内,一个站点应当能够从发送方式切换到接收方式.

![1661515420261](C:\Users\22719\AppData\Local\Temp\1661515420261.png)

当站点检测到信道是空闲的,并且所i发送的数据帧不是成功发送完上一个数据帧之后立即连续发送的数据帧,则不使用退避算法.

一下情况必须使用退避算法: 在发送数据帧之前检测到信道处于忙状态时; 在每一次重传一个数据帧时;在每一次成功发送后要连续发送下一个帧时(这是为了避免一个站点长时间占用信道).

CSMA/CA协议的退避算法:

在执行退避算法时,站点为退避计时器设置一个随机的退避时间:  当退避计时器的时间减少到零时,就开始发送数据;   当退避计时器的时间还未减小到零时而信道又转变为忙状态,这时就冻结退避计时器的数值,重新等待信道变为空闲,再经过时间DIFS后,继续启动退避计时器.

在进行第i次退避时,退避时间在时隙编号{0,1....2^(i+1)-1}中随机选择一个,然后乘以基本退避时间(也就是一个时隙的长度)就可以得到随机的退避时间.这样做是为了使不同站点选择相同退避时间的概率减少.当时隙编号达到255时(对应于第6次退避)就不再增加了.

CSMA/CA协议的退避算法:

![1661518470534](C:\Users\22719\AppData\Local\Temp\1661518470534.png)

CSMA/CA协议的信道预约和虚拟载波监听:

为了尽可能减少碰撞的概率和降低碰撞的影响,802.11标准允许要发送数据的站点对信道进行预约.

(1) 源站点在发送数据帧之前先发送一个短的控制帧,称为请求发送RTS,它包括源地址,目的地址以及这次通信(包括相应的确认帧)所需的持续时间.

(2)若目的站正确收到源站发来的RTS帧,且媒体空闲,就发送一个响应控制帧,称为允许发送CTS,它也包括这次通信所需的持续时间(从RTS帧中将此持续时间复制到CTS帧中).

(3)源站收到CTS帧后,再等待一段时间SIFS后,就可发送其数据帧.

(4)若目的站正确收到了源站发来的数据帧,在等待时间SIFS后,就向源站发送确认帧ACK.

(5)除源站和目的站以外的其他各站,在收到CTS帧(或数据帧)后就推迟接入到无线局域网中.这样就保证了源站和目的站之间的通信不会收到其他站的干扰.

(6)如果RTS帧发生碰撞,源站就收不到CTS帧,需执行退避算法重传RTS帧.

(7)由于RTS帧和CTS帧很短,发送碰撞的概率,碰撞产生的开销及本身的开销都很小.而对于一般的数据帧,其发送时延往往大于传播时延(因为是局域网),碰撞的概率很大,且一旦发生碰撞而导致数据帧重发,则浪费的时间就很多,因此用很小的代价对信道进行预约往往是值得的.802.11标准规定了3种情况用户选择:

使用RTS帧和CTS帧

不使用RTS帧和CTS帧

只有当数据帧的长度超过某一数值时才使用RTS帧和CTS帧.

除RTS帧和CTS帧会携带通信需要持续的时间,数据帧也能携带通信需要持续的时间,这称为802.11的虚拟载波监听机制.

由于利用虚拟载波监听机制,站点只要监听到RTS帧,CTS帧或数据帧中的任何一个,就能知道信道被占用的持续时间,而不需要真正监听到信道上的信号,因此虚拟载波监听机制能减少隐蔽站带来的碰撞问题.

题目总结:

CSMA是指载波监听多址接入,并不使用确认机制;

CSMA/CD是指载波监听多址接入/碰撞检测,是对CSMA的改进,是早期共享信道以太网使用的信道访问控制协议,并不使用确认机制.

CSMA/CA是载波监听多址接入/碰撞避免,是802.11局域网采用的无线信道访问控制协议.802.11局域网在使用CSMA/CA的同时,还使用停止-等待协议.这是因为无线信道的通信质量不如有线信道,因此无线站点每发送完一个数据帧后,要等到收到对象的确认帧后才能继续发送下一个帧.

CDMA是指码分多址,属于静态划分信道,是物理层的信道复用技术,而不属于MAC协议.

