# 第六章 应用层:

### 6.1 应用层概述

应用层是计算机网络体系结构的最顶层,是设计和建立计算机网络的最终目的,也是计算机网络中发展最快的部分.



## 6.2 客户 ---- 服务器方式和对方式.

网络应用程序运行在处于网络边缘的不同的端系统上,通过彼此间的通信来共同完成某项任务.

开发一种新的网络应用首先要考虑的问题就是网络应用程序在各种端系统上的组织方式和它们之间的关系.

目前流行的主要有以下两种:  客户/服务器(c/s)方式, 对等(p2p)方式.  



1.客户/服务器(C/S)方式:

   客户和服务器是指通信中所涉及的两个应用进程. 客户/服务器方式所描述的是进程之间服务和被服务的关系.   客户是服务的请求方,服务器是服务的提供方.

  服务器总是处于运行状态,并等待客户的服务请求.服务器具有固定端口号(例如HTTP服务器的默认端口号为80),而运行服务器的主机也具有固定的IP地址.

C/S方式是因特网上传统的,同时也是最成熟的方式,很多我们熟悉的网络应用采用的都是C/S方式.包括万维网WWW,电子邮件,文件传输FTP等.

基于C/S方式的应用服务通常是服务集中型的,即应用服务集中在网络中比客户计算机少得多的服务器计算机上.

   由于一台服务器计算机要为多个客户机提供服务,在C/S应用中,常会出现服务器计算机跟不上众多客户机请求的情况.

   为此,在C/S应用中,常用计算机群集(或服务器场)构建一个强大的虚拟服务器.

2.对等(P2P)方式:

   在P2P方式中,没有固定的服务请求者和服务提供者,分布在网络边缘各端系统中的应用程序是对等的,被称为对等方.对等方相互之间直接通信,每个对等方即是服务的请求者,又是服务的提供者.

目前,在因特网上流行的P2P应用主要包括P2P文件共享,即使通信,P2P流媒体,分布式存储等.

基于P2P的应用是服务分散型的,因为服务不是集中在少数几个服务器计算机中,而是分散在大量对等计算机中,这些计算机并不为服务商所有,而是为个人控制的桌面计算机和笔记本电脑,它们通常位于住宅,校园和办公室中.

P2P方式的最突出特性之一就是它的可扩展性.因为系统每增加一个对等方,不仅增加的是服务的请求者,同时也增加了服务的提供者,系统性能不会因大规模的增加而降低.

P2P方式具有有成本上的优势,因为它通常不需要庞大的服务器带宽.为了降低成本,服务器提供商对于P2P方式用于应用的兴趣越来越大>

### 6.3 动态主机配置协议DHCP

![1661932219848](C:\Users\22719\AppData\Local\Temp\1661932219848.png)

![1661932558729](C:\Users\22719\AppData\Local\Temp\1661932558729.png)

## 6.4 域名系统DNS

1.因特网采用层次树状结构的域名结构:

  域名的结构由若干个分量组成,各分量之间用"点"隔开,分别代表不同级别的域名.

​    ..... . 三级域名.二级域名.顶级域名

  每一级的域名都由英文字母和数字组成,不超过63个字符,不区分大小写字母. 级别最低的域名写在最左边,而级别最高的顶级域名卸载最右边. 完整的域名不超过255个字符.

域名系统既不规定一个域名需要多少个下级域名,也不规定每一级域名代表什么意思.

各级域名由其上一级的域名管理机构管理.而最高的顶级域名则由因特网名称与数字地址分配机构ICANN进行管理.

![1661936179180](C:\Users\22719\AppData\Local\Temp\1661936179180.png)

![1661936200581](C:\Users\22719\AppData\Local\Temp\1661936200581.png)

![1661936262357](C:\Users\22719\AppData\Local\Temp\1661936262357.png)

![1661936288735](C:\Users\22719\AppData\Local\Temp\1661936288735.png)

为了提高DNS的查询效率,并减轻根域名服务器的负荷和减少因特网上的DNS查询报文数量,在域名服务器种广泛地使用了高速缓存.高速缓存用来存放醉经查询过的域名一级从何处获得域名映射信息的记录.

由于域名到Ip地址的映射关系并不是永久不变,为保持高速缓存中的内容正确,域名服务器应为每项内容设置计时器并删除超过合理时间的项(例如,每个项目只存放两天).

不但在本地域名服务器种需要高速缓存,在用户主机中也很需要.许多用户主机在启动时从本地域名服务器下载域名和IP地址的全部数据库,维护存放在自己最近使用的域名的高速缓存,并且只在从缓存中找不到域名时才向域名服务器查询.同理,主机也需要保持高速缓存中内容的正确性.

## 6.5 文件传送协议FTP

将某台计算机中的文件通过网络传送到可能相距很远的另一台计算机中,是一项基本的网络应用,即文件传送.

 文件传送协议FTP是因特网上使用得最广泛得文件传送协议.

​     FTP提供交互式的访问,允许客户指明文件的类型与格式(如指明是否使用ASCLL码),并允许文件具有存取权限(如访问文件的用户必须经过授权,并输入有效的口令).

​    FTP屏蔽了各计算机系统的细节,因而适合于在异构网络中任何计算机之间传送文件.

在因特网发展的早期阶段,用FTP传送文件约占整个因特网的通信量的三分之一,而由电子邮件和域名系统所产生的通信量还要小于FTP所产生的通信量.只是到了1995年,万维网WWW的通信量才首次超过了FTP.

FTP的常见用途是在计算机之间传输文件,尤其是用于批量传输文件/  FTP的另一个常见用途是让网站设计者将构成网站内容的大量文件批量上传到它们的web服务器.

![1661937766608](C:\Users\22719\AppData\Local\Temp\1661937766608.png)

FTP客户和服务器之间要建立以下两个并行的TCP连接:

  一个是控制连接,在整个会话期间一直保持打开,用于传送FTP相关控制命令.另一个是数据连接,用于文件传输,在每次文件传输时才建立,传输结束就关闭.

默认情况下,FTP使用TCP 21端口号进行控制连接, TCP20端口进行数据连接. 但是,是否使用TCP20端口建立数据连接与传输模式有关,主动方式使用TCP 20端口,被动方式由服务器和客户端自行协商决定.,



## 6.6 电子邮件

![1661942482465](C:\Users\22719\AppData\Local\Temp\1661942482465.png)

![1661948731833](C:\Users\22719\AppData\Local\Temp\1661948731833.png)

![1661948769683](C:\Users\22719\AppData\Local\Temp\1661948769683.png)

![1661948812233](C:\Users\22719\AppData\Local\Temp\1661948812233.png)

电子邮件的信息格式并不是由SMTP定义的,而是在RFC 822中单独定义的.这个RFC文档已在2008年更新为RFC 5322.一个电子邮件有信封和内容两部分.而内容又由首部和主体两部分构成.

![1661949006100](C:\Users\22719\AppData\Local\Temp\1661949006100.png)

![1661949031167](C:\Users\22719\AppData\Local\Temp\1661949031167.png)

![1661949068263](C:\Users\22719\AppData\Local\Temp\1661949068263.png)

### 6.7 万维网WWW

万维网WWW并非某种特殊的计算机网络.它是一个大规模的,联机的信息储藏所,是运行在因特网上的一个分布式应用.  万维网利用网页之间的超链接将不同网站的网页链接成一张逻辑上的信息网.

为了方便地访问在世界范围地文档,万维网使用统一资源定位符URL来指明因特网上任何种类"资源"的位置.

URL的一般形式由以下四个部分组成:

 <协议>://<主机>:<端口>/<路径>.

## 1. 超文本传输协议HTTP: 

HTTP定义了浏览器(即万维网客户进程)怎样向万维网服务器请求万维网文档,以及万维网服务器怎样把万维网文档传送给浏览器.

HTTP/1.0采用非持续连接方式.在该方式下,每次浏览器要请求一个文件都要与服务器建立TCP连接,当收到响应后就立即关闭.

  每请求一个文档就要有两倍的RTT的开销.若一个网页上有很多引用对象(例如图片等),那么请求每一个对象都要花费2RTT的时间.

  为了减少时延,浏览器通常会建立多个并行的TCP连接同时请求多个对象.但是,这会大量占用万维网服务器的资源,特别是万维网服务器往往要同时服务于大量客户的请求,这会使其负担很重.

HTTP/1.1采用持续连接方式.在该方式下,万维网服务器在发送响应后仍然保持这条连接,使同一个客户(浏览器)和该服务器可以在这条连接上传送后续的HTTP请求报文和响应报文.这并不局限于传送同一个页面上引用的对象,而是只要这些文档都在同一个服务器上就行.

​    为了进一步提高效率,HTTP/1.1的持续连接还可以使用流水线方式工作,即浏览器在收到HTTP的响应报文之前就能够发送多个请求报文.这样的一个接一个的请求报文到达服务器后,服务器就发回一个一个的响应报文.这样就节省了很多个RTT时间,使TCP连接中的空闲时间减少,提高了下载文档的效率.



HTTP的报文格式:

![1661952517329](C:\Users\22719\AppData\Local\Temp\1661952517329.png)

HTTP响应报文格式:

![1661952561290](C:\Users\22719\AppData\Local\Temp\1661952561290.png)

使用Cookie在服务器上记录用户信息:

   早期的万维网应用非常简单,仅仅是用户查看存放在不同服务器上的各种静态的文档.因此HTTP被设计为一种无状态的协议.这样可以简化服务器的设计.

   现在,用户可以通过万维网实现各种复杂的应用,这些应用往往需要万维网服务器能够识别用户.

   Cookie提供了一种机制使得万维网服务器能够"记住用户",而无需用户主动提供用户标识信息.也就是说,Cookie是对一种无状态的HTTP进行状态化的技术.



万维网缓存与代理服务器:

   在万维网中还可以使用缓存机制以提高万维网的效率. 万维网缓存又称为web缓存,可位于客户机,也可位于中间系统上,位于中间系统上的web缓存又称为代理服务器.

  web缓存把最近的一些请求和响应暂存在本地磁盘中.当新请求到达时,若发现这个请求与暂时存放的请求相同,就返回暂存的响应,而不需要按URL的地址再次去因特网访问该资源.

