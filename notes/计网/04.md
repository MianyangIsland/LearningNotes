## 3.7 MAC地址.IP地址以及ARP协议:

### 一. MAC地址(数据链路层)

当多个主机在同一个广播信道上,想要实现两个主机之间的通信,则每个主机都必须有一个唯一的表示,即一个数据链路层地址.

在每个主机发送的帧中必须携带标识发送主机和接收主机的地址.由于这类地址是用于媒体接入控制MAC,因此这类地址被称为MAC地址.

MAC地址一般被固化在网卡(网络适配器)的电可擦可编程只读存储器EEPROM中,因此MAC地址也被称为硬件地址.

MAC地址有时也被称为物理地址.请注意:这并不意味着AMC地址属于网络体系结构中的物理层.

一般情况下,用户主机包含两个网络适配器:有线局域网适配器(有线网卡)和无线局域网适配器(无线网卡).每个网络适配器都有一个全球唯一的MAC地址.而交换机和路由器往往拥有更多的网络接口,所以会拥有更多的AMC地址.综上所述,严格来说,MAC地址是对网络上各接口的唯一标识,而不是对网络上各设备的唯一标识.

### 二.IP地址(网络层)

IP地址是因特网上的主机和路由器所使用的地址,用于标识两部分信息:

网络编号: 标识因特网上数以百万计的网络.   主机编号: 标识同一网络上不同主机.

很显然,之前介绍的AMC地址不具备区分不同网络的功能.

如果只是一个单独的网络,不接入英特网,可以只使用MAC地址(这不是一般用户的应用方式)

如果主机所在的网络要接入因特网,则IP地址和MAC地址都需要使用.

在数据包的转发过程中,源IP地址和目的地址始终保持不变;而源AMC地址和目的MAC地址遂段链路(或逐个网络)改变.

### 三. ARP协议(地址解析协议)

源主机在自己的ARP高速缓存表中查找目的主机的IP地址所对应的MAC地址,若找到了,则可以封装MAC帧进行发送;若找不到,则发送ARP请求(封装在广播MAC帧中).

目的主机收到ARP请求后,将源主机的IP地址于MAC地址记录到自己的ARP高速缓存表中,然后给源主机发送ARP响应(封装在单播MAC帧中),ARP响应中包含有目的主机的IP地址和MAC地址;

源主机收到ARP响应后,将目的主机的IP地址与MAC地址记录到自己的ARP高速缓存表中,然后就可以封装之前想发送的AMC帧并发送给目的主机;

ARP的作用范围:逐段链路或逐个网络使用;

除ARP请求和响应外,ARP还有其他类型的报文(例如用于检查IP地址冲突的"无故ARP,免费ARP:);

ARP没有安全验证机制,存在ARP欺骗(攻击)问题.

### 3.8  集线器与交换机的区别:

##### 使用双绞线和集线器HUB的星型以太网:

使用集线器的以太网在逻辑上仍是一个总线网,各站共享总线资源,使用的还是CSMA/CD协议;

集线器只工作在物理层,它的每个接口仅简单地转发比特,不进行碰撞检测(由各站地网卡检测);

集线器一般都有少量的容错能力和网络管理功能.例如,若网络中某个网卡出现了故障,不停地转发帧.此时,集线器可以检测到这个问题,在内部断开与出故障网卡地连线,使整个以太网仍然能正常工作.

##### 使用集线器HUB在物理层扩展以太网:

以太网交换机:

以太网交换机通常都有多个接口.每个接口都可以与一台主机或另一个以太网交换机相连.一般都工作在全双工方式.

以太网交换机具有并行性,能同时连同多个接口,使多对主机能够同时通信,无碰撞(不使用CSMA/CD协议)

以太网交换机一般都具有多种速率的接口,例如:10MB/S.100MB/S,!GB/S,10GB/S接口的多种组合.

以太网交换机工作在数据链路层(也包括物理层),它收到帧后,在帧交换表中查找帧的目的MAC地址所对应的接口号,然后通过该接口转发帧.

以太网交换机是一种即插即用设备,其内部的帧交换表是通过自学习算法自动地逐渐建立起来的.

帧的两种转发方式:

1.存储转发.

2.直接转发:采用基于硬件的交叉矩阵(交换时延非常小,但不检查帧是否有差错).

交换机的每个接口是一个独立的碰撞域.

交换机隔离碰撞域但不隔离广播域.

### 3.9 以太网交换机自学习和转发帧的流程

以太网交换机工作在数据链链路层(也包括物理层)

以太网交换机收到帧后,在帧交换表中查找帧的目的MAC地址所对应的接口号,然后接口转发帧.

以太网交换机是一种即插即用设备,刚上电启动时内部的帧交换表是空的.随着网络中各主机间的通信,以太网交换机通过自学算法自动逐渐建立起帧交换表.

以太网交换机自学习和转发帧的流程:

  1.收到帧后进行登记.登记的内容为帧的源MAC地址及进入交换机的接口号;

  2.根据帧的目的MAC地址和交换机的帧交换表对帧进行转发,有以下三种情况:

​      明确转发:交换机知道应当从哪个(或那些)接口转发帧(单播,多播,广播)

​      盲目转发;交换机不知道应当从哪个端口转发帧,只能将其通过除进入交换机的接口外的其他所有接口转发(也称为泛红).

​       明确转发:交换机知道不应该转发该帧,将其丢弃.

帧交换表中的每条记录都有自己的有效时间,到期删除.原因如下:

   交换机的接口该接了另一台主机;

   主机更换了网卡;

## 3.10 以太网交换机的生成树协议STP

   如何提高以太网的可靠性?

   添加冗余链路可以提高以太网的可靠性. 但是冗余链路也会带来负面效应   ----  形成网络环路

  网络环路会带来一下问题:

​    广播风暴:  大量消耗网络资源,使得网络无法正常转发其他数据帧.

   主机收到重复的广播帧;  大量消耗主机资源

​    交换机的帧交换表震荡(漂移).

以太网交换机实验生成树协议STP可以在增加冗余链路来提高网络可靠性的同时又避免网络环路带来的各种问题.

  不论交换机之间采用怎样的物理连接,交换机都能够自动计算并构建一个逻辑上没有环路的网络,其逻辑拓扑接口必须是树型(无逻辑环路).

 最终生成的树型逻辑拓扑要确保联通整个网络;

 当首次连接交换机或网络拓扑发生变化时(有可能人为改变或故障),交换机都将进行生成树的重新计算.

## 3.11.1虚拟局域网VLAN概述

以太网交换机工作在数据链路层(也包括物理层). 使用一个或多个以太网交换机互连起来的交换式以太网,其所有站点都属于同一个广播域.

随着交换式以太网规模的扩大,广播域相应扩大.

巨大的广播域会带来很多弊端:广播风暴  难以管理和维护    潜在的安全问题.

网络中会频繁出现广播信息.

分割广播域的方法: 使用路由器可以隔离广播域,但路由器成本较高,虚拟局域网VLAN技术应运而生.

虚拟局域网VLAN是一种将局域网内的设备划分成与物理位置无关的逻辑组的技术,这些逻辑组具有某些共同的需求.

### 3.11.2 虚拟局域网VLAN的实现机制

 ![1661672171831](C:\Users\22719\AppData\Local\Temp\1661672171831.png)

交换机端口类型:

![1661672537650](C:\Users\22719\AppData\Local\Temp\1661672537650.png)

![1661673016366](C:\Users\22719\AppData\Local\Temp\1661673016366.png)

在由多个交换机互连而成的交换式以太网划分VLAN时,连接主机的交换机端口应设置为Access类型,交换机之间互连的端口应该设置为Trunk类型.



